Чат-бот по техническому заданию
1. Основной функционал бота
1.1. Платежная система

Генерация уникального кошелька TON:

    При регистрации пользователя, бот генерирует уникальный кошелек TON и сохраняет его в базе данных.
    Кошелек используется для приема платежей за подписку.

Интеграция с обменником:

    Использование API выбранного обменника для конвертации рублевых платежей в TON.
    Учет комиссии обменника при конвертации.
    Уведомление пользователя о успешной оплате и зачислении средств на его кошелек.

Логика распределения платежей:

    20% от каждого платежа за подписку отправляется на индивидуальный баланс пользователя, пригласившего нового подписчика.
    80% от платежа поступает на основной счёт проекта.

Донатная система:

    Кнопка "Донат" в интерфейсе бота.
    Донаты переводятся на отдельный благотворительный счёт.
    Вся информация о собранных донатах доступна администратору в виде отчёта.

1.2. Реферальная система

Генерация уникальной реферальной ссылки:

    При регистрации нового подписчика, бот генерирует уникальную реферальную ссылку.
    Ссылка содержит идентификатор пригласившего пользователя.

Отслеживание количества привлечённых пользователей:

    Бот фиксирует каждого подписчика, зарегистрировавшегося по реферальной ссылке.
    После 5 успешно приглашённых пользователей бот автоматически присваивает статус "привилегированный" и открывает доступ к "приватной комнате".

Реализация выплат:

    20% от подписки автоматически зачисляются на баланс пригласившего пользователя.
    Возможность вывести накопленные средства (TON) с помощью команды в боте.

1.3. "Приватная комната"

Организация "приватной комнаты":

    Контент в канале делится на два типа:
        Обычные посты (доступны всем подписчикам).
        Посты для "привилегированных" участников (приватная комната).
    После достижения 5 приглашённых подписчиков бот автоматически добавляет пользователя в список "привилегированных".
    Сообщения, предназначенные для "приватной комнаты", помечаются специальным тегом или меткой.
    Видимость таких сообщений ограничивается: они доступны только для пользователей со статусом "привилегированный".

1.4. Единоразовая подписка

    Подписка оформляется один раз и действует бессрочно.
    После успешной оплаты пользователь получает доступ к:
        Основному каналу с анонсами и новостями.
        Приватной комнате (при выполнении условия реферальной системы).

2. Управление бота и функционал администратора
2.1. Административные команды

Просмотр статистики:

    Общее количество подписчиков.
    Количество пользователей с "привилегированным статусом".
    Динамика привлечения подписчиков.
    Статистика по выплатам и доходам (раздельно для основного счёта и донатного счёта).

Управление доступами:

    Возможность вручную добавлять или удалять пользователя из "приватной комнаты".
    Ручное обновление статуса в случае технических сбоев.

2.2. Уведомления и отчёты

Уведомление пользователя:

    "Поздравляем! Вы открыли доступ к эксклюзивной комнате!" при достижении 5 приглашённых.

Еженедельные отчёты для администратора:

    Общее количество подписчиков.
    Суммы на счетах.
    Список активных "привилегированных" пользователей.

2.3. Автоматизация контента

Запланированные посты:

    Возможность запланировать посты (обычные и для "приватной комнаты").
    Техническое деление постов по доступу:
        Обычные сообщения.
        Сообщения с доступом для "привилегированных" пользователей.

3. Программные требования
3.1. Интеграции

Интеграция с TON Blockchain:

    Использование API для создания кошельков и обработки транзакций.

Интеграция с обменником:

    Автоматизация процесса конвертации рублевых платежей в TON.
    Учёт комиссии при конвертации.
    Отправка уведомлений пользователю после успешной оплаты.

3.2. Инфраструктура

Хостинг для бота:

    Рекомендуется использовать надёжный сервер (например, AWS или аналог) для обеспечения стабильной работы.

Система безопасности:

    Шифрование данных пользователей.
    Проверка транзакций на стороне TON для предотвращения мошенничества.

3.3. Техническая поддержка

Логирование действий бота:

    Для анализа ошибок и ведения отчётности.

Возможность обновления бота:

    Для добавления новых функций.

4. Этапы реализации

    Настройка базового функционала бота:
        Регистрация пользователей, создание реферальных ссылок.
        Организация платежной системы.

    Настройка "приватной комнаты":
        Ограничение видимости сообщений для участников без привилегированного статуса.

    Интеграция донатной системы:
        Создание отдельного счёта для донатов.
        Отчётность по донатам.

    Тестирование:
        Проверка всех функций (регистрация, реферальная система, платежи, "приватная комната").

Техническая архитектура
1. База данных

    Пользователи: id, имя, кошелек TON, реферальная ссылка, количество приглашённых, статус (обычный/привилегированный), баланс.
    Транзакции: id, пользователь_id, сумма, тип (подписка/донат), дата.
    Посты: id, текст, тип (общий/приватный), дата публикации.

2. Серверная часть

    API для взаимодействия с TON Blockchain.
    API для взаимодействия с обменником.
    API для управления контентом и статистикой.

3. Клиентская часть

    Telegram бот:
        Команды для регистрации, оплаты, просмотра баланса, вывода средств.
        Интерфейс для донатов.
        Уведомления и сообщения.

4. Административная панель

    Просмотр статистики.
    Управление доступами.
    Запланированные посты.
1. Установка необходимых библиотек

Убедитесь, что у вас установлены необходимые библиотеки:

pip install pyTelegramBotAPI tonclient

Запуск административной панели
python admin.py


1. API и Интеграции
1.1. TON Blockchain API

    Цель: Создание кошельков и обработка транзакций.
    Методы:
        create_wallet: Создание нового кошелька.
        transfer: Перевод средств между кошельками.

1.2. Обменник API

    Цель: Конвертация рублевых платежей в TON.
    Методы:
        convert_rub_to_ton: Конвертация рублей в TON.

1.3. Telegram Bot API

    Цель: Взаимодействие с пользователями через Telegram.
    Методы:
        send_message: Отправка сообщений.
        get_updates: Получение обновлений (сообщений) от пользователей.

2. План Тестирования
2.1. Функциональное Тестирование

    Регистрация пользователей:
        Проверка создания кошелька TON.
        Проверка генерации уникальной реферальной ссылки.
    Оплата подписки:
        Проверка конвертации рублей в TON.
        Проверка распределения платежей (20% на баланс пригласившего, 80% на основной счёт).
    Реферальная система:
        Проверка отслеживания приглашённых пользователей.
        Проверка присвоения статуса "привилегированный" после 5 приглашений.
    Донатная система:
        Проверка перевода донатов на благотворительный счёт.
        Проверка отчётов по донатам.
    Приватная комната:
        Проверка ограничения доступа к приватным сообщениям.
        Проверка автоматического добавления пользователей в "приватную комнату".

2.2. Интеграционное Тестирование

    TON Blockchain API:
        Проверка успешного создания кошелька.
        Проверка успешного перевода средств.
    Обменник API:
        Проверка успешной конвертации рублей в TON.
    Telegram Bot API:
        Проверка отправки сообщений.
        Проверка получения и обработки сообщений.

2.3. Нагрузочное Тестирование

    Множественные пользователи:
        Проверка работы бота с большим количеством одновременных пользователей.
    Большие объёмы данных:
        Проверка производительности при большом количестве транзакций и пользователей.

3. План Развертывания и Тестирования в PyCharm
3.1. Настройка Проекта в PyCharm

    Создание Проекта:
        Откройте PyCharm и создайте новый проект.
        Выберите интерпретатор Python (рекомендуется использовать виртуальное окружение).

    Установка Библиотек:
        Откройте терминал в PyCharm и установите необходимые библиотеки:

        sh

        pip install pyTelegramBotAPI tonclient

    Создание Файлов:
        Создайте файлы config.py, bot.py, admin.py и директорию templates с HTML-шаблонами, как описано выше.

3.2. Запуск и Тестирование Бота

    Запуск Бота:
        Откройте bot.py и запустите его.
        Убедитесь, что бот успешно подключается к Telegram и отвечает на команды.

    Запуск Административной Панели:
        Откройте admin.py и запустите его.
        Откройте браузер и перейдите по адресу http://127.0.0.1:5000 для доступа к административной панели.

    Функциональное Тестирование:
        Регистрация:
            Используйте команду /start для регистрации нового пользователя.
            Проверьте, что кошелек TON и реферальная ссылка созданы корректно.
        Оплата Подписки:
            Используйте команду /subscribe и переведите 1 TON на указанный адрес.
            Проверьте, что 20% от суммы зачисляются на баланс пригласившего пользователя, а 80% на основной счёт.
        Реферальная Система:
            Пригласите 5 пользователей по реферальной ссылке.
            Проверьте, что статус "привилегированный" присвоен пригласившему пользователю.
        Донатная Система:
            Используйте команду /donate и переведите TON на благотворительный счёт.
            Проверьте, что донаты отображаются в отчётах администратора.
        Приватная Комната:
            Проверьте, что пользователи с статусом "привилегированный" имеют доступ к приватным сообщениям.

    Интеграционное Тестирование:
        TON Blockchain API:
            Проверьте, что кошелек TON создаётся успешно.
            Проверьте, что транзакции проходят успешно.
        Обменник API:
            Проверьте, что конвертация рублей в TON работает корректно.
        Telegram Bot API:
            Проверьте, что сообщения отправляются и接收正确.

    Нагрузочное Тестирование:
        Множественные Пользователи:
            Используйте инструменты нагрузочного тестирования (например, Locust) для симуляции большого числа пользователей.
        Большие Объёмы Данных:
            Заполните базу данных большим количеством пользователей и транзакций.
            Проверьте, что бот и административная панель работают стабильно.

1. Создание и Активация Виртуального Окружения
 sudo  apt install python3.12-venv

    Создание виртуального окружения:

    sh

python3 -m venv myenv

Активация виртуального окружения:

    На Linux/MacOS:

    sh

source myenv/bin/activate

На Windows:

sh

        myenv\Scripts\activate

2. Установка Необходимых Пакетов

После активации виртуального окружения установите необходимые пакеты:

sh

pip install pyTelegramBotAPI ton-client-py

3. Проверка Установки

Проверьте, что пакеты установлены корректно:

sh

pip list

Вы должны увидеть pyTelegramBotAPI и ton-client-py в списке установленных пакетов.
4. 

Полный Пример

    Установка зависимостей:

    sh

sudo apt-get update
sudo apt-get install build-essential zlib1g-dev

Скачивание и установка OpenSSL 1.1:

sh

wget https://www.openssl.org/source/openssl-1.1.1k.tar.gz
tar -xzf openssl-1.1.1k.tar.gz
cd openssl-1.1.1k
./config --prefix=/usr/local/ssl1.1 --openssldir=/usr/local/ssl1.1 shared zlib
make
sudo make install

Настройка переменных окружения:

sh

echo 'export LD_LIBRARY_PATH=/usr/local/ssl1.1/lib:$LD_LIBRARY_PATH' >> ~/.bashrc
echo 'export PATH=/usr/local/ssl1.1/bin:$PATH' >> ~/.bashrc
source ~/.bashrc

Проверка установки:

sh

ldconfig -p | grep libssl

Активация виртуального окружения:

sh

source myenv/bin/activate

Установка необходимых пакетов:

sh

pip install pyTelegramBotAPI ton-client-py

Запуск бота:

sh

python bot.py

############################################3
Шаги для Решения Проблемы

    Убедитесь, что OpenSSL 1.1 установлен:

    Проверьте, что библиотека libssl.so.1.1 действительно находится в указанной директории:

    sh

ls /usr/local/ssl1.1/lib

Вы должны увидеть libssl.so.1.1 в списке файлов.

Настройка переменных окружения:

Добавьте следующие строки в ваш .bashrc или .profile файл:

sh

export LD_LIBRARY_PATH=/usr/local/ssl1.1/lib:$LD_LIBRARY_PATH
export PATH=/usr/local/ssl1.1/bin:$PATH

Примените изменения:

sh

source ~/.bashrc

Перезапуск виртуального окружения:

Убедитесь, что вы активировали виртуальное окружение:

sh

source myenv/bin/activate

Проверка переменных окружения:

Проверьте, что переменные окружения настроены правильно:

sh

echo $LD_LIBRARY_PATH
echo $PATH

Убедитесь, что /usr/local/ssl1.1/lib и /usr/local/ssl1.1/bin присутствуют в выводе.

Проверка доступности библиотеки:

Проверьте, что библиотека libssl.so.1.1 доступна:

sh

    ldconfig -p | grep libssl

    Вы должны увидеть libssl.so.1.1 в списке.

Полный Пример

    Убедитесь, что OpenSSL 1.1 установлен:

    sh

ls /usr/local/ssl1.1/lib

Настройка переменных окружения:

sh

echo 'export LD_LIBRARY_PATH=/usr/local/ssl1.1/lib:$LD_LIBRARY_PATH' >> ~/.bashrc
echo 'export PATH=/usr/local/ssl1.1/bin:$PATH' >> ~/.bashrc
source ~/.bashrc

Перезапуск виртуального окружения:

sh

source myenv/bin/activate

Проверка переменных окружения:

sh

echo $LD_LIBRARY_PATH
echo $PATH

Проверка доступности библиотеки:

sh

ldconfig -p | grep libssl

Запуск бота:

sh

python bot.py

pip show ton-client-py

@lyalikdenis25rest_bot